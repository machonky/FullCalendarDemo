@page
@model FullCalendarDemo.Pages.CalendarModel

@{
    ViewData["Title"] = "Calendar";
}

<h1>Calendar</h1>
<script>

    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            editable: true,
            selectable: true,
            events: '/Calendar?handler=BusinessDays',
            select: function (info) {
                var startDate = info.startStr;
                var endDate = info.endStr;

                var token = document.querySelector('input[name="__RequestVerificationToken"]').value;

                // Make an AJAX request to the Razor Page endpoint
                fetch('/Calendar?handler=SelectedEvents', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': token // Include the anti-forgery token in the headers
                    },
                    body: JSON.stringify({ startDate: startDate, endDate: endDate })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Refetch the events and rerender the calendar
                            calendar.refetchEvents();
                        }
                    })
                    .catch(error => {
                        // Handle any errors
                        console.error('Error:', error);
                    });
            }
        });
        calendar.render();
    });

</script>

<div id='calendar'></div>

@Html.AntiForgeryToken()

@* <table class="table">
    <thead>
        <tr>
            <th scope="col">Day Of Week</th>
            <th scope="col">Date</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.BusinessDayModels) {
            <tr>
                <td>@item.DayOfWeek</td>
                <td>@item.Date.ToString("yyyy-MM-dd")</td>
            </tr>
        }
    </tbody>
</table> *@
